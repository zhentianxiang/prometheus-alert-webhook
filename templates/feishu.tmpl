{{define "feishu_message"}}[
    {{- range $i, $alert := .alerts -}}
    {{if $i}},{{end}}
    {
        "msg_type": "interactive",
        "card": {
            "config": {
                "wide_screen_mode": true,
                "enable_forward": true
            },
            "header": {
                "template": "{{if eq $alert.Status `resolved`}}green{{else}}red{{end}}",
                "title": {
                    "tag": "plain_text",
                    "content": "PrometheusAlert"
                }
            },
            "elements": [
                {
                    "tag": "div",
                    "text": { "tag": "lark_md", "content": "{{if eq $alert.Status `resolved`}}✅ Kubernetes 集群恢复通知 ✅{{else}}🚨 Kubernetes 集群告警通知 🚨{{end}}" }
                },
                {
                    "tag": "div",
                    "text": { "tag": "lark_md", "content": "🔔 **告警名称:** {{$alert.Labels.alertname}}\n🚩 **告警级别:** {{$alert.Labels.severity}}" }
                },
                { "tag": "hr" },
                {
                    "tag": "div",
                    "text": { "tag": "lark_md", "content": "🔥 **告警状态:** {{$alert.Status}}\n🕒 **开始时间:** {{getCSTtime $alert.StartsAt}}{{if eq $alert.Status `resolved`}}\n🕒 **结束时间:** {{getCSTtime $alert.EndsAt}}{{end}}" }
                },
                { "tag": "hr" },
                {
                    "tag": "div",
                    "text": { "tag": "lark_md", "content": "**📌 告警详情**\n{{- range $alert.Fields}}\n- {{.key}} {{.value}}{{- end}}" }
                },
                { "tag": "hr" },
                {
                    "tag": "div",
                    "text": { "tag": "lark_md", "content": "**📝 告警描述**\n{{- if $alert.Annotations.summary}}**摘要:** {{$alert.Annotations.summary}}\n{{end}}{{- if $alert.Annotations.message}}**详情:** {{$alert.Annotations.message}}{{- end}}{{if not (or $alert.Annotations.summary $alert.Annotations.message)}}暂无描述{{end}}" }
                },
                { "tag": "hr" },
                {
                    "tag": "div",
                    "text": { "tag": "lark_md", "content": "**📅 告警时间线**\n- **首次触发:** {{getCSTtime $alert.StartsAt}}" }
                },
                { "tag": "hr" },
                {
                    "tag": "div",
                    "text": { "tag": "lark_md", "content": "**📞 联系支持**\n如有疑问，请联系 Kubernetes 运维团队或查看相关文档。" }
                },
                { "tag": "hr" },
                {
                    "tag": "div",
                    "text": { "tag": "lark_md", "content": "{{if eq $alert.Status `resolved`}}**✅ 告警已恢复，请确认业务正常运行！**{{else}}**🔔 请及时处理，避免影响业务正常运行！**{{end}}" }
                },
                {
                    "tag": "note",
                    "elements": [
                        {
                            "tag": "plain_text",
                            "content": "PrometheusAlert"
                        }
                    ]
                }
            ]
        }
    }
    {{- end -}}
]
{{end}}